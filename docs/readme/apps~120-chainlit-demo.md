---
title: Chainlit å·¥å…·è°ƒç”¨æ¼”ç¤º
---

# Chainlit å·¥å…·è°ƒç”¨æ¼”ç¤º

ä¸€ä¸ªåŸºäº **LangGraph + Chainlit** çš„æ™ºèƒ½ AI åŠ©æ‰‹ï¼Œæ”¯æŒäº¤äº’å¼é¢„è®¾é—®é¢˜é€‰æ‹©ã€å·¥å…·è°ƒç”¨å’Œå¤šæ¨¡æ€å¤„ç†ã€‚

## ğŸ“‹ ç›®å½•

- [æ ¸å¿ƒç‰¹æ€§](#æ ¸å¿ƒç‰¹æ€§)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [é¢„è®¾é—®é¢˜åŠŸèƒ½](#é¢„è®¾é—®é¢˜åŠŸèƒ½)
- [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
- [å·¥å…·è°ƒç”¨æµç¨‹](#å·¥å…·è°ƒç”¨æµç¨‹)
- [å¦‚ä½•éªŒè¯å·¥å…·è°ƒç”¨](#å¦‚ä½•éªŒè¯å·¥å…·è°ƒç”¨)
- [æµ‹è¯•ç”¨ä¾‹](#æµ‹è¯•ç”¨ä¾‹)
- [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
- [è‡ªå®šä¹‰æ‰©å±•](#è‡ªå®šä¹‰æ‰©å±•)
- [ç¤ºä¾‹é¡¹ç›®](#ç¤ºä¾‹é¡¹ç›®)

---

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### âœ¨ ä¸»è¦åŠŸèƒ½
- **ğŸ¯ äº¤äº’å¼é¢„è®¾é—®é¢˜** - å¯åŠ¨æ—¶æ˜¾ç¤º 5 ä¸ªé¢„è®¾é—®é¢˜æŒ‰é’®ä¾›é€‰æ‹©
- **ğŸ”§ å·¥å…·è°ƒç”¨** - æ”¯æŒæ—¶é—´æŸ¥è¯¢ã€æ•°å­¦è®¡ç®—ç­‰å·¥å…·
- **ğŸ–¼ï¸ å¤šæ¨¡æ€æ”¯æŒ** - å¤„ç†æ–‡æœ¬å’Œå›¾ç‰‡è¾“å…¥
- **ğŸ‘ï¸ å¯è§†åŒ–è¿½è¸ª** - å®æ—¶æ˜¾ç¤ºå·¥å…·æ‰§è¡Œè¿‡ç¨‹
- **ğŸ“ è¯¦ç»†æ—¥å¿—** - å®Œæ•´çš„æ‰§è¡Œè½¨è¿¹è®°å½•

### ğŸ—ï¸ æ¶æ„ç‰¹ç‚¹
- **åˆ†å±‚è®¾è®¡** - UI å±‚ã€ä¸šåŠ¡é€»è¾‘å±‚ã€å·¥å…·å±‚æ¸…æ™°åˆ†ç¦»
- **ä»£ç å¤ç”¨** - æ ¸å¿ƒå¤„ç†é€»è¾‘å¯åœ¨å¤šå¤„å¤ç”¨
- **æ˜“äºæ‰©å±•** - é…ç½®é©±åŠ¨çš„é¢„è®¾é—®é¢˜ï¼Œç®€å•æ·»åŠ æ–°å·¥å…·
- **ç±»å‹å®‰å…¨** - ä½¿ç”¨ TypedDict å®šä¹‰çŠ¶æ€

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### è¿è¡Œä¸»åº”ç”¨

```bash
uv run chainlit run apps/05-chainlit-tool-call/main.py -whd --host 0.0.0.0 --port 8000
```

åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š**http://localhost:8000**

### é¦–æ¬¡ä½¿ç”¨ä½“éªŒ

1. **æ¬¢è¿ç•Œé¢** - æ‰“å¼€é¡µé¢è‡ªåŠ¨æ˜¾ç¤ºæ¬¢è¿æ¶ˆæ¯
2. **é€‰æ‹©é—®é¢˜** - ä» 5 ä¸ªé¢„è®¾é—®é¢˜æŒ‰é’®ä¸­é€‰æ‹©ä¸€ä¸ª
3. **è§‚å¯Ÿæ‰§è¡Œ** - æŸ¥çœ‹å·¥å…·è°ƒç”¨è¿‡ç¨‹å’Œæœ€ç»ˆå“åº”
4. **ç»§ç»­å¯¹è¯** - å¯ä»¥ç»§ç»­è¾“å…¥é—®é¢˜æˆ–ä¸Šä¼ å›¾ç‰‡

---

## ğŸ¯ é¢„è®¾é—®é¢˜åŠŸèƒ½

### 5 ä¸ªç²¾å¿ƒè®¾è®¡çš„é¢„è®¾é—®é¢˜

åº”ç”¨å¯åŠ¨æ—¶ï¼Œä¼šæ˜¾ç¤ºä»¥ä¸‹ 5 ä¸ªå¯ç‚¹å‡»çš„é—®é¢˜æŒ‰é’®ï¼š

| æŒ‰é’® | é—®é¢˜å†…å®¹ | è§¦å‘çš„å·¥å…· |
|------|---------|-----------|
| â° **æŸ¥è¯¢å½“å‰æ—¶é—´** | "ç°åœ¨å‡ ç‚¹äº†ï¼Ÿè¯·å‘Šè¯‰æˆ‘å½“å‰çš„æ—¶é—´ã€‚" | `get_current_time` |
| ğŸ”¢ **æ•°å­¦è®¡ç®—** | "è¯·å¸®æˆ‘è®¡ç®— 42 * 7 ç­‰äºå¤šå°‘ï¼Ÿ" | `calculator` |
| ğŸ”§ **å¤šå·¥å…·ç»„åˆ** | "ç°åœ¨å‡ ç‚¹äº†ï¼Ÿå¦å¤–å¸®æˆ‘ç®—ä¸€ä¸‹ 100 é™¤ä»¥ 4 ç­‰äºå¤šå°‘ã€‚" | å¤šä¸ªå·¥å…· |
| ğŸ¤– **AGI é¢„æµ‹** | "ä½ è§‰å¾—äººå·¥æ™ºèƒ½ AGI åœ¨å¤šå°‘å¹´åå®ç°ï¼Œé‚£æ—¶æ˜¯å‡ å‡ å¹´ï¼Ÿ" | æ—¶é—´æŸ¥è¯¢ + æ¨ç† |
| ğŸ’¬ **æ™®é€šå¯¹è¯** | "ä½ å¥½ï¼è¯·ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±å’Œä½ çš„èƒ½åŠ›ã€‚" | ä¸è§¦å‘å·¥å…· |

### å®ç°åŸç†

- ä½¿ç”¨ Chainlit çš„ `AskActionMessage` API å®ç°äº¤äº’å¼æŒ‰é’®é€‰æ‹©
- é…ç½®å­˜å‚¨åœ¨ `main.py` çš„ `PRESET_QUESTIONS` åˆ—è¡¨ä¸­
- 5 åˆ†é’Ÿè¶…æ—¶è®¾ç½®ï¼Œå¯ä»¥è·³è¿‡å¹¶ç›´æ¥è¾“å…¥é—®é¢˜
- é€‰æ‹©åè‡ªåŠ¨å¤„ç†å¹¶æ˜¾ç¤ºç»“æœ

### å¦‚ä½•è‡ªå®šä¹‰é¢„è®¾é—®é¢˜

ç¼–è¾‘ `main.py` ä¸­çš„ `PRESET_QUESTIONS` åˆ—è¡¨ï¼š

```python
PRESET_QUESTIONS = [
    {
        "name": "your_question_id",        # å”¯ä¸€æ ‡è¯†ç¬¦
        "label": "ğŸ”¥ æŒ‰é’®æ˜¾ç¤ºæ–‡æœ¬",         # ç”¨æˆ·çœ‹åˆ°çš„æŒ‰é’®æ–‡å­—
        "question": "å®é™…å‘é€çš„é—®é¢˜å†…å®¹",   # å‘é€ç»™ AI çš„é—®é¢˜
        "description": "ç®€çŸ­æè¿°"           # æŒ‰é’®çš„è¯´æ˜æ–‡å­—
    },
    # æ·»åŠ æ›´å¤šé—®é¢˜...
]
```

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
apps/05-chainlit-tool-call/
â”œâ”€â”€ main.py                    # åº”ç”¨å…¥å£ç‚¹ + LangGraph é…ç½®
â”œâ”€â”€ handlers.py                # æ¶ˆæ¯å¤„ç†å™¨ï¼šæ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”œâ”€â”€ tools.py                   # å·¥å…·å®šä¹‰ï¼ˆæ—¶é—´æŸ¥è¯¢ã€è®¡ç®—å™¨ï¼‰
â”œâ”€â”€ utils.py                   # å·¥å…·å‡½æ•°ï¼ˆå›¾ç‰‡å‹ç¼©ï¼‰
â”œâ”€â”€ main_file_upload_demo.py   # æ–‡ä»¶ä¸Šä¼ æ¼”ç¤º
â”œâ”€â”€ pyproject.toml             # é¡¹ç›®ä¾èµ–
â””â”€â”€ README.md                  # æœ¬æ–‡æ¡£
```

### ä»£ç ç»„ç»‡æ¶æ„

é‡‡ç”¨æ¸…æ™°çš„**ä¸‰å±‚æ¶æ„**è®¾è®¡ï¼š

#### ğŸ“± **main.py** - è¡¨ç°å±‚ï¼ˆUI å±‚ï¼‰
**èŒè´£ï¼š** Chainlit åº”ç”¨å…¥å£ï¼Œå¤„ç†ç”¨æˆ·äº¤äº’

- Chainlit ç”Ÿå‘½å‘¨æœŸé’©å­ï¼ˆ`@cl.on_chat_start`, `@cl.on_message`ï¼‰
- LangGraph å›¾å®šä¹‰å’Œç¼–è¯‘
- é¢„è®¾é—®é¢˜é…ç½®
- è½»é‡çº§ï¼Œä¸»è¦è´Ÿè´£åè°ƒå’Œå§”æ‰˜

**ä»£ç é‡ï¼š** 195 è¡Œ

#### ğŸ§  **handlers.py** - ä¸šåŠ¡é€»è¾‘å±‚
**èŒè´£ï¼š** æ¶ˆæ¯å¤„ç†çš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘

- `handle_user_message()` - æ ¸å¿ƒæ¶ˆæ¯å¤„ç†å‡½æ•°
- å¤šæ¨¡æ€å†…å®¹å¤„ç†ï¼ˆæ–‡æœ¬ + å›¾ç‰‡ï¼‰
- LangGraph agent é›†æˆ
- å·¥å…·è°ƒç”¨è¿½è¸ªå’Œ UI æ›´æ–°
- é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

**ä»£ç é‡ï¼š** 172 è¡Œ

#### ğŸ”§ **tools.py** - å·¥å…·å±‚
**èŒè´£ï¼š** LangChain å…¼å®¹çš„å·¥å…·å®šä¹‰

- `get_current_time()` - è·å–å½“å‰æ—¶é—´
- `calculator()` - æ‰§è¡Œæ•°å­¦è®¡ç®—è¡¨è¾¾å¼

**ä»£ç é‡ï¼š** 57 è¡Œ

#### ğŸ› ï¸ **utils.py** - å·¥å…·å‡½æ•°å±‚
**èŒè´£ï¼š** çº¯å·¥å…·å‡½æ•°ï¼Œæ— çŠ¶æ€

- `compress_image_if_needed()` - æ™ºèƒ½å›¾ç‰‡å‹ç¼©
- æ ¹æ® Claude API æ ‡å‡†è¿›è¡Œä¼˜åŒ–

**ä»£ç é‡ï¼š** 74 è¡Œ

### ä¾èµ–å…³ç³»å›¾

```
main.py (è¡¨ç°å±‚)
  â†“ å¯¼å…¥
  â”œâ”€ handlers.py (ä¸šåŠ¡é€»è¾‘å±‚)
  â”‚    â†“ å¯¼å…¥
  â”‚    â””â”€ utils.py (å·¥å…·å‡½æ•°å±‚)
  â”‚
  â””â”€ tools.py (å·¥å…·å±‚)
```

---

## ğŸ”„ å·¥å…·è°ƒç”¨æµç¨‹

```
ç”¨æˆ·è¾“å…¥ï¼ˆæ–‡æœ¬/å›¾ç‰‡ï¼‰
         â†“
   LangGraph å¤„ç†
         â†“
   LLM åˆ†æï¼ˆæ˜¯å¦éœ€è¦å·¥å…·ï¼Ÿï¼‰
         â†“ æ˜¯
   è°ƒç”¨å·¥å…·ï¼ˆUI å’Œæ§åˆ¶å°æ˜¾ç¤ºï¼‰
         â†“
   å·¥å…·æ‰§è¡Œï¼ˆå†…éƒ¨æ—¥å¿—ï¼‰
         â†“
   è¿”å›ç»“æœï¼ˆUI å’Œæ§åˆ¶å°æ˜¾ç¤ºï¼‰
         â†“
   LLM ä½¿ç”¨ç»“æœç”Ÿæˆæœ€ç»ˆå“åº”
         â†“
   æ˜¾ç¤ºæœ€ç»ˆç­”æ¡ˆ
```

### è¯¦ç»†æµç¨‹è¯´æ˜

1. **ç”¨æˆ·è¾“å…¥** â†’ é€šè¿‡ Chainlit UI è¾“å…¥æ–‡æœ¬æˆ–ä¸Šä¼ å›¾ç‰‡
2. **æ¶ˆæ¯æ„å»º** â†’ åœ¨ `handlers.py` ä¸­æ„å»ºå¤šæ¨¡æ€æ¶ˆæ¯
3. **å›¾å¤„ç†** â†’ LangGraph çš„ StateGraph å¼€å§‹å¤„ç†
4. **æ¨¡å‹èŠ‚ç‚¹** â†’ LLM åˆ†ææ˜¯å¦éœ€è¦è°ƒç”¨å·¥å…·
5. **å·¥å…·èŠ‚ç‚¹** â†’ å¦‚æœéœ€è¦ï¼Œæ‰§è¡Œå·¥å…·å¹¶è·å–ç»“æœ
6. **å¾ªç¯å¤„ç†** â†’ å¯èƒ½å¤šè½®å·¥å…·è°ƒç”¨
7. **æœ€ç»ˆå“åº”** â†’ è¿”å›ç»™ç”¨æˆ·

---

## âœ… å¦‚ä½•éªŒè¯å·¥å…·è°ƒç”¨

æä¾›**ä¸‰ç§æ–¹å¼**ç¡®è®¤å·¥å…·æ˜¯å¦è¢«æ­£ç¡®è°ƒç”¨ï¼š

### 1ï¸âƒ£ Chainlit UIï¼ˆå¯è§†åŒ–æ­¥éª¤ï¼‰

åœ¨èŠå¤©ç•Œé¢ä¸­ï¼Œä½ ä¼šçœ‹åˆ°å¯æŠ˜å çš„æ­¥éª¤é¢æ¿ï¼š

```
â”Œâ”€ ğŸ”§ Calling calculator â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”§ Calling tool: calculator         â”‚
â”‚  ğŸ“ Arguments: {'expression': '42*7'}â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ âœ… Tool Result: calculator â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Result: 42*7 = 294                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2ï¸âƒ£ æ§åˆ¶å°æ—¥å¿—ï¼ˆè¯¦ç»†æ‰§è¡Œè·Ÿè¸ªï¼‰

ç»ˆç«¯æ˜¾ç¤ºå®Œæ•´çš„æ‰§è¡Œæ—¥å¿—ï¼š

```bash
==================================================
ğŸš€ å¼€å§‹å¤„ç†ç”¨æˆ·è¯·æ±‚
==================================================

ğŸ“‹ æ£€æµ‹åˆ°å·¥å…·è°ƒç”¨ (ç¬¬ 1 è½®)
  ğŸ”§ å·¥å…·: calculator
  ğŸ“ å‚æ•°: {'expression': '42*7'}

  âœ… å·¥å…· calculator è¿”å›ç»“æœ: 42*7 = 294

==================================================
âœ¨ å¤„ç†å®Œæˆ (å…±è°ƒç”¨ 1 è½®å·¥å…·)
==================================================
```

### 3ï¸âƒ£ å·¥å…·å‡½æ•°æ—¥å¿—ï¼ˆå†…éƒ¨æ‰§è¡Œç»†èŠ‚ï¼‰

æ¯ä¸ªå·¥å…·å‡½æ•°è¾“å‡ºè‡ªå·±çš„æ‰§è¡Œè¯¦æƒ…ï¼š

```bash
ğŸ”§ [Tool Call] get_current_time(timezone='UTC')
âœ… [Tool Return] Current UTC time: 2025-11-22 10:30:45

ğŸ”§ [Tool Call] calculator(expression='100/4')
âœ… [Tool Return] Result: 100/4 = 25.0
```

---

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹

### å¯åŠ¨æµ‹è¯•ï¼ˆé¢„è®¾é—®é¢˜ï¼‰

æ‰“å¼€åº”ç”¨åï¼Œç‚¹å‡»ä»»æ„é¢„è®¾é—®é¢˜æŒ‰é’®ï¼š

- â° æŸ¥è¯¢å½“å‰æ—¶é—´
- ğŸ”¢ æ•°å­¦è®¡ç®—
- ğŸ”§ å¤šå·¥å…·ç»„åˆ
- ğŸ¤– AGI é¢„æµ‹
- ğŸ’¬ æ™®é€šå¯¹è¯

### æ‰‹åŠ¨è¾“å…¥æµ‹è¯•

#### ğŸ• æ—¶é—´æŸ¥è¯¢
```
ç°åœ¨å‡ ç‚¹äº†ï¼Ÿ
What time is it now?
Tell me the current time
```

#### ğŸ”¢ æ•°å­¦è®¡ç®—
```
42 ä¹˜ä»¥ 7 ç­‰äºå¤šå°‘ï¼Ÿ
What is 42 times 7?
Calculate (10 + 5) * 3
100 divided by 4
```

#### ğŸ–¼ï¸ å¤šæ¨¡æ€ï¼ˆå›¾ç‰‡åˆ†æï¼‰
1. ä¸Šä¼ å›¾ç‰‡ï¼ˆä¾‹å¦‚ `apps/05-chainlit-tool-call/img/claude-code.png`ï¼‰
2. è¾“å…¥é—®é¢˜ï¼š
   ```
   è¯·åˆ†æè¿™å¼ å›¾ç‰‡çš„å†…å®¹
   è¿™å¼ å›¾ç‰‡æ˜¾ç¤ºäº†ä»€ä¹ˆï¼Ÿ
   ```

#### ğŸ”§ å¤šå·¥å…·è°ƒç”¨
```
ç°åœ¨å‡ ç‚¹äº†ï¼Ÿå¦å¤–å¸®æˆ‘ç®—ä¸€ä¸‹ 100 / 4
What time is it? Also calculate 2 ** 10
å‘Šè¯‰æˆ‘å½“å‰æ—¶é—´ï¼Œç„¶åè®¡ç®— 50 * 3
```

#### ğŸ’¬ æ™®é€šå¯¹è¯ï¼ˆä¸è§¦å‘å·¥å…·ï¼‰
```
ä½ å¥½
è¯·ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±
What is LangGraph?
```

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç”¨é€” | ç‰ˆæœ¬è¦æ±‚ |
|------|------|---------|
| **LangChain** | å·¥å…·å®šä¹‰å’Œæ¶ˆæ¯å¤„ç† | æœ€æ–°ç‰ˆ |
| **LangGraph** | Agent å·¥ä½œæµç¼–æ’ | æœ€æ–°ç‰ˆ |
| **Chainlit** | Web UI å’Œç”¨æˆ·äº¤äº’ | æœ€æ–°ç‰ˆ |
| **OpenAI API** | LLM æ¨ç†ï¼ˆé€šè¿‡ OpenRouterï¼‰ | GPT-4/Claude |
| **Pillow (PIL)** | å›¾ç‰‡å¤„ç†å’Œå‹ç¼© | â‰¥ 9.0 |

### API é…ç½®

éœ€è¦è®¾ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

```bash
export OPENROUTER_API_KEY="your_api_key"
export OPENROUTER_BASE_URL="https://openrouter.ai/api/v1"  # å¯é€‰
```

---

## ğŸ”§ è‡ªå®šä¹‰æ‰©å±•

### æ·»åŠ æ–°å·¥å…·

#### 1. åœ¨ `tools.py` ä¸­å®šä¹‰å·¥å…·

```python
from langchain_core.tools import tool

@tool
def search_web(query: str) -> str:
    """æœç´¢äº’è”ç½‘å¹¶è¿”å›ç»“æœ

    Args:
        query: æœç´¢å…³é”®è¯

    Returns:
        æœç´¢ç»“æœæ‘˜è¦
    """
    print(f"ğŸ”§ [Tool Call] search_web(query='{query}')")

    # å®ç°æœç´¢é€»è¾‘
    result = f"æœç´¢ '{query}' çš„ç»“æœ..."

    print(f"âœ… [Tool Return] {result}")
    return result
```

#### 2. åœ¨ `main.py` ä¸­æ³¨å†Œå·¥å…·

```python
from tools import get_current_time, calculator, search_web

# å·¥å…·åˆ—è¡¨
tools = [get_current_time, calculator, search_web]  # æ·»åŠ æ–°å·¥å…·
```

#### 3. æ— éœ€ä¿®æ”¹ `handlers.py`ï¼

å·¥å…·è‡ªåŠ¨é€šè¿‡ LangGraph çš„ `app` å¯¹è±¡å¯ç”¨ã€‚

### æ·»åŠ æ–°çš„é¢„è®¾é—®é¢˜

åœ¨ `main.py` ä¸­ä¿®æ”¹ `PRESET_QUESTIONS`ï¼š

```python
PRESET_QUESTIONS = [
    # ... ç°æœ‰é—®é¢˜ ...
    {
        "name": "web_search",
        "label": "ğŸ” ç½‘ç»œæœç´¢",
        "question": "å¸®æˆ‘æœç´¢ä¸€ä¸‹æœ€æ–°çš„äººå·¥æ™ºèƒ½æ–°é—»",
        "description": "è§¦å‘ search_web å·¥å…·"
    },
]
```

### æ·»åŠ æ–°çš„æ¶ˆæ¯å¤„ç†æ–¹å¼

åœ¨ `handlers.py` ä¸­æ·»åŠ æ–°å‡½æ•°ï¼š

```python
async def handle_streaming_chat(app, query: str):
    """å¤„ç†çº¯èŠå¤©è¯·æ±‚ï¼ˆä¸è¿½è¸ªå·¥å…·è°ƒç”¨ï¼‰"""
    # å®ç°ç®€åŒ–çš„æµå¼èŠå¤©é€»è¾‘
    pass
```

åœ¨ `main.py` ä¸­ä½¿ç”¨ï¼š

```python
@cl.on_message
async def main(message: cl.Message):
    if message.content.startswith("/chat"):
        await handle_streaming_chat(app, message.content)
    else:
        await handle_user_message(app, message.content, message.elements)
```

---

## ğŸ“š ç¤ºä¾‹é¡¹ç›®

### ç¤ºä¾‹ 1ï¼šå·¥å…·è°ƒç”¨æ¼”ç¤ºï¼ˆmain.pyï¼‰

ä¸»æ¼”ç¤ºåº”ç”¨ï¼Œå±•ç¤º LangGraph + å·¥å…·è°ƒç”¨ + å¯è§†åŒ–è¿½è¸ªã€‚

**è¿è¡Œï¼š**
```bash
uv run chainlit run apps/05-chainlit-tool-call/main.py -whd --host 0.0.0.0 --port 8000
```

**ç‰¹ç‚¹ï¼š**
- âœ… å¯åŠ¨æ—¶æ˜¾ç¤ºé¢„è®¾é—®é¢˜
- âœ… å·¥å…·è°ƒç”¨ï¼ˆæ—¶é—´æŸ¥è¯¢ã€è®¡ç®—å™¨ï¼‰
- âœ… å¤šæ¨¡æ€æ”¯æŒï¼ˆæ–‡æœ¬ + å›¾ç‰‡ï¼‰
- âœ… å¯è§†åŒ–å·¥å…·è°ƒç”¨è¿½è¸ª

---

### ç¤ºä¾‹ 2ï¼šæ–‡ä»¶ä¸Šä¼ æ¼”ç¤ºï¼ˆmain_file_upload_demo.pyï¼‰

äº¤äº’å¼æ•™ç¨‹ï¼Œæ¼”ç¤º `AskFileMessage` çš„æ–‡ä»¶ä¸Šä¼ æ¨¡å¼ã€‚

**è¿è¡Œï¼š**
```bash
uv run chainlit run apps/05-chainlit-tool-call/main_file_upload_demo.py -whd --host 0.0.0.0 --port 8000
```

**åŠŸèƒ½ï¼š**
- ğŸ“„ **å•æ–‡ä»¶ä¸Šä¼ ** - æç¤ºä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ï¼Œæ”¯æŒç±»å‹è¿‡æ»¤
- ğŸ“¦ **å¤šæ–‡ä»¶ä¸Šä¼ ** - ä¸€æ¬¡ä¸Šä¼ æœ€å¤š 3 ä¸ªæ–‡ä»¶
- ğŸ¯ **æ–‡ä»¶ç±»å‹å¤„ç†** - è‡ªåŠ¨å¤„ç†æ–‡æœ¬ã€å›¾ç‰‡ã€PDF
- ğŸ¨ **æ˜¾ç¤ºæ¨¡å¼** - inlineï¼ˆå†…è”ï¼‰ã€sideï¼ˆä¾§è¾¹æ ï¼‰ã€pageï¼ˆæ•´é¡µï¼‰
- ğŸ¤– **AI åˆ†æ** - è‡ªåŠ¨ä½¿ç”¨è§†è§‰æ¨¡å‹åˆ†æå›¾ç‰‡
- ğŸ“‹ **å…ƒç´ ç±»å‹** - Textã€Imageã€PDFã€File ç­‰å¤šç§å…ƒç´ 

**å­¦ä¹ å†…å®¹ï¼š**
1. ä½¿ç”¨ `cl.AskFileMessage()` æç¤ºç”¨æˆ·ä¸Šä¼ æ–‡ä»¶
2. ä½¿ç”¨ `accept` å‚æ•°é…ç½®æ–‡ä»¶ç±»å‹è¿‡æ»¤
3. ä½¿ç”¨ `max_files` å’Œ `max_size_mb` è®¾ç½®ä¸Šä¼ é™åˆ¶
4. ä½¿ç”¨ `timeout` å’Œ `raise_on_timeout` å¤„ç†è¶…æ—¶
5. å¤„ç†ä¸åŒæ–‡ä»¶ç±»å‹ï¼ˆæ–‡æœ¬ã€å›¾ç‰‡ã€PDFï¼‰
6. ä½¿ç”¨ä¸åŒæ˜¾ç¤ºæ¨¡å¼åˆ›å»ºå’Œå±•ç¤ºå…ƒç´ 
7. å°†æ–‡ä»¶ä¸Šä¼ ä¸ LLM åˆ†æé›†æˆ

---

## ğŸ“ æ³¨æ„äº‹é¡¹

### å¼€å‘æç¤º

- âœ… **æ§åˆ¶å°æ—¥å¿—** - ç¡®ä¿å¯ä»¥çœ‹åˆ°ç»ˆç«¯è¾“å‡ºä»¥è§‚å¯Ÿå®Œæ•´çš„æ‰§è¡Œæµç¨‹
- âœ… **UI æ­¥éª¤** - Chainlit UI ä¸­çš„æ­¥éª¤é¢æ¿åœ¨æ¶ˆæ¯å‘é€åå¯æŠ˜å 
- âœ… **å¤šè½®è°ƒç”¨** - å·¥å…·è°ƒç”¨å¯èƒ½åœ¨å¤šè½®ä¸­å‘ç”Ÿ
- âœ… **é›¶å·¥å…·è°ƒç”¨** - å¦‚æœä¸éœ€è¦å·¥å…·ï¼Œæ§åˆ¶å°ä¼šæ˜¾ç¤º "0 è½®å·¥å…·è°ƒç”¨"

### æ€§èƒ½ä¼˜åŒ–

- **å›¾ç‰‡å‹ç¼©** - è‡ªåŠ¨å‹ç¼©å¤§äº 5MB æˆ–å°ºå¯¸è¶…è¿‡ 1568px çš„å›¾ç‰‡
- **æµå¼å“åº”** - ä½¿ç”¨ `astream` å®ç°æµå¼å¤„ç†ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
- **å»¶è¿ŸåŠ è½½** - å›¾ç‰‡åªåœ¨éœ€è¦æ—¶å‹ç¼©å’Œç¼–ç 

### æœ€ä½³å®è·µ

1. **å·¥å…·è®¾è®¡** - ä¿æŒå·¥å…·åŠŸèƒ½å•ä¸€ï¼Œä¾¿äº LLM ç†è§£å’Œè°ƒç”¨
2. **é”™è¯¯å¤„ç†** - åœ¨å·¥å…·å‡½æ•°ä¸­æ·»åŠ é€‚å½“çš„é”™è¯¯å¤„ç†
3. **æ—¥å¿—è®°å½•** - ä½¿ç”¨ç»Ÿä¸€çš„æ—¥å¿—æ ¼å¼ä¾¿äºè°ƒè¯•
4. **ç±»å‹æç¤º** - ä¸ºå‡½æ•°å‚æ•°æ·»åŠ ç±»å‹æç¤ºæé«˜ä»£ç å¯ç»´æŠ¤æ€§

---

## ğŸ“ è®¾è®¡æ¨¡å¼

### 1. åˆ†å±‚æ¶æ„æ¨¡å¼
- **è¡¨ç°å±‚**ï¼ˆmain.pyï¼‰- å¤„ç† UI äº¤äº’
- **ä¸šåŠ¡é€»è¾‘å±‚**ï¼ˆhandlers.pyï¼‰- å¤„ç†æ ¸å¿ƒé€»è¾‘
- **å·¥å…·å±‚**ï¼ˆtools.py, utils.pyï¼‰- æä¾›å¯å¤ç”¨å‡½æ•°

### 2. ä¾èµ–æ³¨å…¥
```python
# app ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œè€Œéå…¨å±€å˜é‡
await handle_user_message(app, content, elements)
```

### 3. é…ç½®é©±åŠ¨
```python
# é¢„è®¾é—®é¢˜é€šè¿‡é…ç½®åˆ—è¡¨ç®¡ç†
PRESET_QUESTIONS = [...]
```

### 4. å•ä¸€èŒè´£åŸåˆ™
- æ¯ä¸ªæ¨¡å—åªè´Ÿè´£ä¸€ä¸ªç‰¹å®šåŠŸèƒ½
- ä¾¿äºæµ‹è¯•å’Œç»´æŠ¤

---

## ğŸ“– ç›¸å…³èµ„æº

- [Chainlit å®˜æ–¹æ–‡æ¡£](https://docs.chainlit.io/)
- [LangGraph æ–‡æ¡£](https://langchain-ai.github.io/langgraph/)
- [LangChain å·¥å…·æŒ‡å—](https://python.langchain.com/docs/modules/tools/)
- [OpenRouter API](https://openrouter.ai/)

---

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

---

**æœ€åæ›´æ–°ï¼š** 2025-11-22
